/** @file agent.c @author Snyo */

#include "agents/network.h"

#include "agent.h"
#include "util.h"

#include <stdio.h>
#include <string.h>

#include <zlog.h>
#include <json/json.h>

const char *network_metric_names[] = {
};

// TODO configuration parsing
plugin_t *new_network_agent(const char *name, const char *conf) {
	plugin_t *agent = new_agent(name, NETWORK_AGENT_PERIOD);
	if(!agent) return NULL;

	// network spec setup
	spec_t *spec = (spec_t *)malloc(sizeof(spec_t));
	if(!spec) {
		zlog_error(agent->tag, "Failed to allocate network spec");
		delete_agent(agent);
		return NULL;
	}

	agent->type = "network_linux_v1";
	agent->id   = "test";
	agent->agent_ip  = "test";
	agent->target_ip = "test";

	// inheritance
	agent->spec = spec;

	// polymorphism
	agent->metric_names    = network_metric_names;
	agent->collect_metrics = collect_network_metrics;
	agent->delete = delete_agent;

	return agent;
}

void collect_network_metrics(plugin_t *agent) {
	zlog_debug(agent->tag, "Collecting metrics");

	json_object *values = json_object_new_array();

	add_metrics(agent, values);
}

void delete_agent(plugin_t *agent) {
	free(agent->spec);
	delete_agent(agent);
}